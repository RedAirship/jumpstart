# Testing React components using ShallowRenderer and Jest snapshots

## Setup

React apps created using `create-react-app` come with Jest installed. Use

    npm test

to run the tests in watch mode, and

    env CI=true npm test

to run the tests in single-run mode (most CI tools like CircleCI will set the
`CI` environment variable for you).

To render components using the [ShallowRenderer][], install `react-test-renderer`:

    npm install --save-dev react-test-renderer

## Functional Components

Tests for stateless functional components are usually quite straightforward
since the HTML rendered by the component is a pure function of the `props`
passed into the component. Let's take a Books components as an example:

```javascript
// src/Books.js

import React from "react";

const Books = ({ books }) => {
  if (books.length === 0) {
    return <div>No books found</div>;
  }

  return (
    <ul>
      {books.map(book => {
        return <li>{book.title}</li>;
      })}
    </ul>
  );
};

export default Books;
```

This component displays a list of book titles or a 'no data' message when no
books are passed into it. A test for this may look like:

```javascript
import React from "react";
import ShallowRenderer from "react-test-renderer/shallow";
import Books from "./Books.js";

test('shows a "no data" message when no books are passed in', () => {
  const renderer = new ShallowRenderer();
  renderer.render(<Books books={[]} />);
  const output = renderer.getRenderOutput();

  expect(output).toMatchSnapshot();
});
```

This test uses [Jest's snapshot testing][snapshot] feature.

The first time this test runs, Jest will store the snapshot in a
`__snapshots__` directly relative to the test file. On subsequent runs, Jest
compares the stored snapshot with the latest render and reports any differences
if found.

Snapshots should be generated by running the tests locally and then committed
into your git history. Snapshots will not be generated when tests are run in
CI.

[ShallowRenderer]: https://reactjs.org/docs/shallow-renderer.html
[snapshot]: https://jestjs.io/docs/en/snapshot-testing.html
